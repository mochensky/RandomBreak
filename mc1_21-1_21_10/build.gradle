plugins {
    id 'fabric-loom'
}

sourceSets {
    main {
        java {
            srcDirs 'src/main/java'
        }
        resources {
            srcDirs 'src/main/resources', '../main'
        }
    }
}

def version_suffix = '1.21-1.21.10'

dependencies {
    minecraft "com.mojang:minecraft:1.21.10"
    mappings "net.fabricmc:yarn:1.21.10+build.3:v2"
    modImplementation "net.fabricmc:fabric-loader:0.17.2"
    modImplementation "net.fabricmc.fabric-api:fabric-api:0.138.3+1.21.10"
}

processResources {
    inputs.property 'version', project.version
    inputs.property 'loader_version', '0.17.2'
    inputs.property 'minecraft_version_range', '>=1.21 <=1.21.10'
    filteringCharset 'UTF-8'

    filesMatching('fabric.mod.json') {
        expand 'version': project.version,
                'loader_version': '0.17.2',
                'minecraft_version_range': '>=1.21 <=1.21.10'
    }

    duplicatesStrategy = DuplicatesStrategy.EXCLUDE
}

tasks.withType(JavaCompile).configureEach {
    options.release.set(21)
}

tasks.named('sourcesJar') {
    duplicatesStrategy = DuplicatesStrategy.EXCLUDE
}

remapJar {
    archiveVersion = "${project.version}-mc${version_suffix}"
    destinationDirectory = file("${project.rootDir}/build/libs")
}

remapSourcesJar {
    archiveVersion = "${project.version}-mc${version_suffix}"
    destinationDirectory = file("${project.rootDir}/build/libs")
}
